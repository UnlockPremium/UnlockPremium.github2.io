<!-- ADD: TikTok open-in-browser overlay -->
<style>
  #tiktok-overlay {
    position:fixed;inset:0;z-index:2147483647;
    display:flex;align-items:center;justify-content:center; 
    background:rgba(0,0,0,0.85);backdrop-filter:blur(6px);
    color:#fff;padding:20px;box-sizing:border-box;
    flex-direction:column;gap:18px;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;
  }
  #tiktok-overlay .card {max-width:420px;text-align:center;}
  #tiktok-overlay h2{margin:0 0 8px;font-size:20px}
  #tiktok-overlay p{margin:0 0 14px;color:rgba(255,255,255,0.9)}
  #tiktok-open-btn{
    appearance:none;padding:12px 18px;border-radius:999px;
    border:none;font-weight:700;background:#00ffcc;color:#000;
    font-size:16px;cursor:pointer;
  }
  /* Keep page behind non-interactive while overlay shown */
  body.tiktok-blocked {pointer-events:none;touch-action:none;user-select:none;}
  body.tiktok-blocked #tiktok-overlay {pointer-events:auto;touch-action:auto;}
</style>

<div id="tiktok-overlay" aria-hidden="true" style="display:none">
  <div class="card">
    <h2>Open in your device browser</h2>
    <p>For best experience tap the button below and open this page in your browser (Chrome / Safari).</p>
    <button id="tiktok-open-btn">Open in browser</button>
    <div style="margin-top:12px;font-size:13px;color:rgba(255,255,255,0.7)">
      If that doesn't work, tap the menu (⋯) → Open in Browser
    </div>
  </div>
</div>

<script>
(function(){
  const ua = navigator.userAgent || '';
  // detect common TikTok in-app UA tokens
  const isTikTok = /TikTok|tiktok|com\.zhiliaoapp\.musically/i.test(ua);

  function showOverlay() {
    const o = document.getElementById('tiktok-overlay');
    if (!o) return;
    o.style.display = 'flex';
    document.documentElement.classList.add('tiktok-blocked');
    document.body.classList.add('tiktok-blocked');
    o.setAttribute('aria-hidden','false');
  }
  function hideOverlay() {
    const o = document.getElementById('tiktok-overlay');
    if (!o) return;
    o.style.display = 'none';
    document.documentElement.classList.remove('tiktok-blocked');
    document.body.classList.remove('tiktok-blocked');
    o.setAttribute('aria-hidden','true');
  }

  // Only show overlay when inside TikTok in-app browser
  if (isTikTok) showOverlay();

  // Button attempts to open externally but we do NOT force-redirect
  const btn = document.getElementById('tiktok-open-btn');
  if (btn) {
    btn.addEventListener('click', function(){
      const loc = window.location.href;
      // Android intent scheme attempt (works in many webviews)
      try {
        const intentUrl = 'intent://' + window.location.hostname + window.location.pathname + window.location.search + '#Intent;scheme=https;action=android.intent.action.VIEW;category=android.intent.category.BROWSABLE;end';
        // setTimeout so if browser blocks, user stays on overlay
        window.location.href = intentUrl;
        // also open a _blank as fallback
        setTimeout(()=>{ window.open(loc,'_blank','noopener,noreferrer'); }, 600);
      } catch(e) {
        // fallback to opening new tab/window
        window.open(loc,'_blank','noopener,noreferrer');
      }
    }, {passive:true});
  }

  // If the page loads NOT in TikTok (user re-opened in normal browser),
  // hide overlay (covers the case when same URL is opened externally)
  if (!isTikTok) hideOverlay();

  // Optional: observe visibility changes (if user leaves and comes back)
  document.addEventListener('visibilitychange', function(){
    // when page becomes visible again re-check UA (some webviews change UA)
    const uaNow = navigator.userAgent || '';
    if (!/TikTok|tiktok|com\.zhiliaoapp\.musically/i.test(uaNow)) {
      hideOverlay();
    }
  });
})();
</script>
